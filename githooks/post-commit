#!/bin/sh
dropbox=~/Dropbox/Documents/env/
if [ ! -d $dropbox ]; then
    exit;
else
    echo "########## Sync Dropbox Hook ################"
    tmptar=tmp.$$.tar
    files="$(git log -n 1 --name-only --oneline | awk 'NR >= 2 && !/^.gitignore/')"
    echo "$files" | tar -cz -T - -f $tmptar
    for a in ${files[@]}
    do
        echo "copy $a -> $dropbox"
    done
    if [ -f $tmptar ]; then
        `mv $tmptar $dropbox; cd $dropbox; tar xfz $tmptar; rm $tmptar`
    fi
    echo "############################################"
fi

